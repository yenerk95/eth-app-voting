{"ast":null,"code":"/*!\n * chacha20.js - chacha20 for bcrypto\n * Copyright (c) 2016-2019, Christopher Jeffrey (MIT License).\n * https://github.com/bcoin-org/bcrypto\n *\n * Resources\n *   https://en.wikipedia.org/wiki/Chacha20\n *   https://tools.ietf.org/html/rfc7539#section-2\n *   https://cr.yp.to/chacha.html\n */\n'use strict';\n\nvar _classCallCheck = require(\"/Users/yenerkaraca/Documents/GitHub/eth-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/yenerkaraca/Documents/GitHub/eth-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar assert = require('../internal/assert');\n/*\n * Constants\n */\n\n\nvar BIG_ENDIAN = new Int8Array(new Int16Array([1]).buffer)[0] === 0;\n/**\n * ChaCha20\n */\n\nvar ChaCha20 = /*#__PURE__*/function () {\n  /**\n   * Create a ChaCha20 context.\n   * @constructor\n   */\n  function ChaCha20() {\n    _classCallCheck(this, ChaCha20);\n\n    this.state = new Uint32Array(16);\n    this.stream = new Uint32Array(16);\n    this.bytes = new Uint8Array(this.stream.buffer);\n    this.pos = -1;\n    if (BIG_ENDIAN) this.bytes = Buffer.alloc(64);\n  }\n  /**\n   * Initialize chacha20 with a key, nonce, and counter.\n   * @param {Buffer} key\n   * @param {Buffer} nonce\n   * @param {Number} counter\n   */\n\n\n  _createClass(ChaCha20, [{\n    key: \"init\",\n    value: function init(key, nonce, counter) {\n      if (counter == null) counter = 0;\n      assert(Buffer.isBuffer(key));\n      assert(Buffer.isBuffer(nonce));\n      assert(Number.isSafeInteger(counter));\n      if (key.length !== 16 && key.length !== 32) throw new RangeError('Invalid key size.');\n\n      if (nonce.length >= 24) {\n        key = ChaCha20.derive(key, nonce.slice(0, 16));\n        nonce = nonce.slice(16);\n      }\n\n      this.state[0] = 0x61707865;\n      this.state[1] = key.length < 32 ? 0x3120646e : 0x3320646e;\n      this.state[2] = key.length < 32 ? 0x79622d36 : 0x79622d32;\n      this.state[3] = 0x6b206574;\n      this.state[4] = readU32(key, 0);\n      this.state[5] = readU32(key, 4);\n      this.state[6] = readU32(key, 8);\n      this.state[7] = readU32(key, 12);\n      this.state[8] = readU32(key, 16 % key.length);\n      this.state[9] = readU32(key, 20 % key.length);\n      this.state[10] = readU32(key, 24 % key.length);\n      this.state[11] = readU32(key, 28 % key.length);\n      this.state[12] = counter >>> 0;\n\n      if (nonce.length === 8) {\n        this.state[13] = counter / 0x100000000 >>> 0;\n        this.state[14] = readU32(nonce, 0);\n        this.state[15] = readU32(nonce, 4);\n      } else if (nonce.length === 12) {\n        this.state[13] = readU32(nonce, 0);\n        this.state[14] = readU32(nonce, 4);\n        this.state[15] = readU32(nonce, 8);\n      } else if (nonce.length === 16) {\n        this.state[12] = readU32(nonce, 0);\n        this.state[13] = readU32(nonce, 4);\n        this.state[14] = readU32(nonce, 8);\n        this.state[15] = readU32(nonce, 12);\n      } else {\n        throw new RangeError('Invalid nonce size.');\n      }\n\n      this.pos = 0;\n      return this;\n    }\n    /**\n     * Encrypt/decrypt data.\n     * @param {Buffer} data - Will be mutated.\n     * @returns {Buffer}\n     */\n\n  }, {\n    key: \"encrypt\",\n    value: function encrypt(data) {\n      assert(Buffer.isBuffer(data));\n      if (this.pos === -1) throw new Error('Context is not initialized.');\n\n      for (var i = 0; i < data.length; i++) {\n        if ((this.pos & 63) === 0) {\n          this._block();\n\n          this.pos = 0;\n        }\n\n        data[i] ^= this.bytes[this.pos++];\n      }\n\n      return data;\n    }\n    /**\n     * Stir the stream.\n     */\n\n  }, {\n    key: \"_block\",\n    value: function _block() {\n      for (var i = 0; i < 16; i++) {\n        this.stream[i] = this.state[i];\n      }\n\n      for (var _i = 0; _i < 10; _i++) {\n        qround(this.stream, 0, 4, 8, 12);\n        qround(this.stream, 1, 5, 9, 13);\n        qround(this.stream, 2, 6, 10, 14);\n        qround(this.stream, 3, 7, 11, 15);\n        qround(this.stream, 0, 5, 10, 15);\n        qround(this.stream, 1, 6, 11, 12);\n        qround(this.stream, 2, 7, 8, 13);\n        qround(this.stream, 3, 4, 9, 14);\n      }\n\n      for (var _i2 = 0; _i2 < 16; _i2++) {\n        this.stream[_i2] += this.state[_i2];\n      }\n\n      if (BIG_ENDIAN) {\n        for (var _i3 = 0; _i3 < 16; _i3++) {\n          writeU32(this.bytes, this.stream[_i3], _i3 * 4);\n        }\n      }\n\n      this.state[12] += 1;\n      if (this.state[12] === 0) this.state[13] += 1;\n    }\n    /**\n     * Destroy context.\n     */\n\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      for (var i = 0; i < 16; i++) {\n        this.state[i] = 0;\n        this.stream[i] = 0;\n      }\n\n      if (BIG_ENDIAN) {\n        for (var _i4 = 0; _i4 < 64; _i4++) {\n          this.bytes[_i4] = 0;\n        }\n      }\n\n      this.pos = -1;\n      return this;\n    }\n    /**\n     * Derive key with XChaCha20.\n     * @param {Buffer} key\n     * @param {Buffer} nonce\n     * @returns {Buffer}\n     */\n\n  }], [{\n    key: \"derive\",\n    value: function derive(key, nonce) {\n      assert(Buffer.isBuffer(key));\n      assert(Buffer.isBuffer(nonce));\n      if (key.length !== 16 && key.length !== 32) throw new RangeError('Invalid key size.');\n      if (nonce.length !== 16) throw new RangeError('Invalid nonce size.');\n      var state = new Uint32Array(16);\n      state[0] = 0x61707865;\n      state[1] = key.length < 32 ? 0x3120646e : 0x3320646e;\n      state[2] = key.length < 32 ? 0x79622d36 : 0x79622d32;\n      state[3] = 0x6b206574;\n      state[4] = readU32(key, 0);\n      state[5] = readU32(key, 4);\n      state[6] = readU32(key, 8);\n      state[7] = readU32(key, 12);\n      state[8] = readU32(key, 16 % key.length);\n      state[9] = readU32(key, 20 % key.length);\n      state[10] = readU32(key, 24 % key.length);\n      state[11] = readU32(key, 28 % key.length);\n      state[12] = readU32(nonce, 0);\n      state[13] = readU32(nonce, 4);\n      state[14] = readU32(nonce, 8);\n      state[15] = readU32(nonce, 12);\n\n      for (var i = 0; i < 10; i++) {\n        qround(state, 0, 4, 8, 12);\n        qround(state, 1, 5, 9, 13);\n        qround(state, 2, 6, 10, 14);\n        qround(state, 3, 7, 11, 15);\n        qround(state, 0, 5, 10, 15);\n        qround(state, 1, 6, 11, 12);\n        qround(state, 2, 7, 8, 13);\n        qround(state, 3, 4, 9, 14);\n      }\n\n      var out = Buffer.alloc(32);\n      writeU32(out, state[0], 0);\n      writeU32(out, state[1], 4);\n      writeU32(out, state[2], 8);\n      writeU32(out, state[3], 12);\n      writeU32(out, state[12], 16);\n      writeU32(out, state[13], 20);\n      writeU32(out, state[14], 24);\n      writeU32(out, state[15], 28);\n      return out;\n    }\n  }]);\n\n  return ChaCha20;\n}();\n/*\n * Static\n */\n\n\nChaCha20.native = 0;\n/*\n * Helpers\n */\n\nfunction qround(x, a, b, c, d) {\n  x[a] += x[b];\n  x[d] = rotl32(x[d] ^ x[a], 16);\n  x[c] += x[d];\n  x[b] = rotl32(x[b] ^ x[c], 12);\n  x[a] += x[b];\n  x[d] = rotl32(x[d] ^ x[a], 8);\n  x[c] += x[d];\n  x[b] = rotl32(x[b] ^ x[c], 7);\n}\n\nfunction rotl32(w, b) {\n  return w << b | w >>> 32 - b;\n}\n\nfunction readU32(data, off) {\n  return data[off++] + data[off++] * 0x100 + data[off++] * 0x10000 + data[off] * 0x1000000;\n}\n\nfunction writeU32(dst, num, off) {\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  return off;\n}\n/*\n * Expose\n */\n\n\nmodule.exports = ChaCha20;","map":{"version":3,"sources":["/Users/yenerkaraca/Documents/GitHub/eth-app/node_modules/bcrypto/lib/js/chacha20.js"],"names":["assert","require","BIG_ENDIAN","Int8Array","Int16Array","buffer","ChaCha20","state","Uint32Array","stream","bytes","Uint8Array","pos","Buffer","alloc","key","nonce","counter","isBuffer","Number","isSafeInteger","length","RangeError","derive","slice","readU32","data","Error","i","_block","qround","writeU32","out","native","x","a","b","c","d","rotl32","w","off","dst","num","module","exports"],"mappings":"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","sourcesContent":["/*!\n * chacha20.js - chacha20 for bcrypto\n * Copyright (c) 2016-2019, Christopher Jeffrey (MIT License).\n * https://github.com/bcoin-org/bcrypto\n *\n * Resources\n *   https://en.wikipedia.org/wiki/Chacha20\n *   https://tools.ietf.org/html/rfc7539#section-2\n *   https://cr.yp.to/chacha.html\n */\n\n'use strict';\n\nconst assert = require('../internal/assert');\n\n/*\n * Constants\n */\n\nconst BIG_ENDIAN = new Int8Array(new Int16Array([1]).buffer)[0] === 0;\n\n/**\n * ChaCha20\n */\n\nclass ChaCha20 {\n  /**\n   * Create a ChaCha20 context.\n   * @constructor\n   */\n\n  constructor() {\n    this.state = new Uint32Array(16);\n    this.stream = new Uint32Array(16);\n    this.bytes = new Uint8Array(this.stream.buffer);\n    this.pos = -1;\n\n    if (BIG_ENDIAN)\n      this.bytes = Buffer.alloc(64);\n  }\n\n  /**\n   * Initialize chacha20 with a key, nonce, and counter.\n   * @param {Buffer} key\n   * @param {Buffer} nonce\n   * @param {Number} counter\n   */\n\n  init(key, nonce, counter) {\n    if (counter == null)\n      counter = 0;\n\n    assert(Buffer.isBuffer(key));\n    assert(Buffer.isBuffer(nonce));\n    assert(Number.isSafeInteger(counter));\n\n    if (key.length !== 16 && key.length !== 32)\n      throw new RangeError('Invalid key size.');\n\n    if (nonce.length >= 24) {\n      key = ChaCha20.derive(key, nonce.slice(0, 16));\n      nonce = nonce.slice(16);\n    }\n\n    this.state[0] = 0x61707865;\n    this.state[1] = key.length < 32 ? 0x3120646e : 0x3320646e;\n    this.state[2] = key.length < 32 ? 0x79622d36 : 0x79622d32;\n    this.state[3] = 0x6b206574;\n    this.state[4] = readU32(key, 0);\n    this.state[5] = readU32(key, 4);\n    this.state[6] = readU32(key, 8);\n    this.state[7] = readU32(key, 12);\n    this.state[8] = readU32(key, 16 % key.length);\n    this.state[9] = readU32(key, 20 % key.length);\n    this.state[10] = readU32(key, 24 % key.length);\n    this.state[11] = readU32(key, 28 % key.length);\n    this.state[12] = counter >>> 0;\n\n    if (nonce.length === 8) {\n      this.state[13] = (counter / 0x100000000) >>> 0;\n      this.state[14] = readU32(nonce, 0);\n      this.state[15] = readU32(nonce, 4);\n    } else if (nonce.length === 12) {\n      this.state[13] = readU32(nonce, 0);\n      this.state[14] = readU32(nonce, 4);\n      this.state[15] = readU32(nonce, 8);\n    } else if (nonce.length === 16) {\n      this.state[12] = readU32(nonce, 0);\n      this.state[13] = readU32(nonce, 4);\n      this.state[14] = readU32(nonce, 8);\n      this.state[15] = readU32(nonce, 12);\n    } else {\n      throw new RangeError('Invalid nonce size.');\n    }\n\n    this.pos = 0;\n\n    return this;\n  }\n\n  /**\n   * Encrypt/decrypt data.\n   * @param {Buffer} data - Will be mutated.\n   * @returns {Buffer}\n   */\n\n  encrypt(data) {\n    assert(Buffer.isBuffer(data));\n\n    if (this.pos === -1)\n      throw new Error('Context is not initialized.');\n\n    for (let i = 0; i < data.length; i++) {\n      if ((this.pos & 63) === 0) {\n        this._block();\n        this.pos = 0;\n      }\n\n      data[i] ^= this.bytes[this.pos++];\n    }\n\n    return data;\n  }\n\n  /**\n   * Stir the stream.\n   */\n\n  _block() {\n    for (let i = 0; i < 16; i++)\n      this.stream[i] = this.state[i];\n\n    for (let i = 0; i < 10; i++) {\n      qround(this.stream, 0, 4, 8, 12);\n      qround(this.stream, 1, 5, 9, 13);\n      qround(this.stream, 2, 6, 10, 14);\n      qround(this.stream, 3, 7, 11, 15);\n      qround(this.stream, 0, 5, 10, 15);\n      qround(this.stream, 1, 6, 11, 12);\n      qround(this.stream, 2, 7, 8, 13);\n      qround(this.stream, 3, 4, 9, 14);\n    }\n\n    for (let i = 0; i < 16; i++)\n      this.stream[i] += this.state[i];\n\n    if (BIG_ENDIAN) {\n      for (let i = 0; i < 16; i++)\n        writeU32(this.bytes, this.stream[i], i * 4);\n    }\n\n    this.state[12] += 1;\n\n    if (this.state[12] === 0)\n      this.state[13] += 1;\n  }\n\n  /**\n   * Destroy context.\n   */\n\n  destroy() {\n    for (let i = 0; i < 16; i++) {\n      this.state[i] = 0;\n      this.stream[i] = 0;\n    }\n\n    if (BIG_ENDIAN) {\n      for (let i = 0; i < 64; i++)\n        this.bytes[i] = 0;\n    }\n\n    this.pos = -1;\n\n    return this;\n  }\n\n  /**\n   * Derive key with XChaCha20.\n   * @param {Buffer} key\n   * @param {Buffer} nonce\n   * @returns {Buffer}\n   */\n\n  static derive(key, nonce) {\n    assert(Buffer.isBuffer(key));\n    assert(Buffer.isBuffer(nonce));\n\n    if (key.length !== 16 && key.length !== 32)\n      throw new RangeError('Invalid key size.');\n\n    if (nonce.length !== 16)\n      throw new RangeError('Invalid nonce size.');\n\n    const state = new Uint32Array(16);\n\n    state[0] = 0x61707865;\n    state[1] = key.length < 32 ? 0x3120646e : 0x3320646e;\n    state[2] = key.length < 32 ? 0x79622d36 : 0x79622d32;\n    state[3] = 0x6b206574;\n    state[4] = readU32(key, 0);\n    state[5] = readU32(key, 4);\n    state[6] = readU32(key, 8);\n    state[7] = readU32(key, 12);\n    state[8] = readU32(key, 16 % key.length);\n    state[9] = readU32(key, 20 % key.length);\n    state[10] = readU32(key, 24 % key.length);\n    state[11] = readU32(key, 28 % key.length);\n    state[12] = readU32(nonce, 0);\n    state[13] = readU32(nonce, 4);\n    state[14] = readU32(nonce, 8);\n    state[15] = readU32(nonce, 12);\n\n    for (let i = 0; i < 10; i++) {\n      qround(state, 0, 4, 8, 12);\n      qround(state, 1, 5, 9, 13);\n      qround(state, 2, 6, 10, 14);\n      qround(state, 3, 7, 11, 15);\n      qround(state, 0, 5, 10, 15);\n      qround(state, 1, 6, 11, 12);\n      qround(state, 2, 7, 8, 13);\n      qround(state, 3, 4, 9, 14);\n    }\n\n    const out = Buffer.alloc(32);\n\n    writeU32(out, state[0], 0);\n    writeU32(out, state[1], 4);\n    writeU32(out, state[2], 8);\n    writeU32(out, state[3], 12);\n    writeU32(out, state[12], 16);\n    writeU32(out, state[13], 20);\n    writeU32(out, state[14], 24);\n    writeU32(out, state[15], 28);\n\n    return out;\n  }\n}\n\n/*\n * Static\n */\n\nChaCha20.native = 0;\n\n/*\n * Helpers\n */\n\nfunction qround(x, a, b, c, d) {\n  x[a] += x[b];\n  x[d] = rotl32(x[d] ^ x[a], 16);\n\n  x[c] += x[d];\n  x[b] = rotl32(x[b] ^ x[c], 12);\n\n  x[a] += x[b];\n  x[d] = rotl32(x[d] ^ x[a], 8);\n\n  x[c] += x[d];\n  x[b] = rotl32(x[b] ^ x[c], 7);\n}\n\nfunction rotl32(w, b) {\n  return (w << b) | (w >>> (32 - b));\n}\n\nfunction readU32(data, off) {\n  return (data[off++]\n        + data[off++] * 0x100\n        + data[off++] * 0x10000\n        + data[off] * 0x1000000);\n}\n\nfunction writeU32(dst, num, off) {\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  return off;\n}\n\n/*\n * Expose\n */\n\nmodule.exports = ChaCha20;\n"]},"metadata":{},"sourceType":"script"}