{"ast":null,"code":"'use strict';\n\nconst {\n  DAGLink,\n  DAGNode\n} = require('ipld-dag-pb');\n\nconst UnixFS = require('ipfs-unixfs');\n\nconst Dir = require('./dir');\n\nconst persist = require('./utils/persist');\n\nclass DirFlat extends Dir {\n  constructor(props, options) {\n    super(props, options);\n    this._children = {};\n  }\n\n  put(name, value) {\n    this.cid = undefined;\n    this.size = undefined;\n    this._children[name] = value;\n  }\n\n  get(name) {\n    return this._children[name];\n  }\n\n  childCount() {\n    return Object.keys(this._children).length;\n  }\n\n  directChildrenCount() {\n    return this.childCount();\n  }\n\n  onlyChild() {\n    return this._children[Object.keys(this._children)[0]];\n  }\n\n  *eachChildSeries() {\n    const keys = Object.keys(this._children);\n\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n      yield {\n        key: key,\n        child: this._children[key]\n      };\n    }\n  }\n\n  async *flush(path, block) {\n    const children = Object.keys(this._children);\n    const links = [];\n\n    for (let i = 0; i < children.length; i++) {\n      let child = this._children[children[i]];\n\n      if (typeof child.flush === 'function') {\n        for await (const entry of child.flush(child.path, block)) {\n          child = entry;\n          yield child;\n        }\n      }\n\n      links.push(new DAGLink(children[i], child.size, child.cid));\n    }\n\n    const unixfs = new UnixFS({\n      type: 'directory',\n      mtime: this.mtime,\n      mode: this.mode\n    });\n    const node = new DAGNode(unixfs.marshal(), links);\n    const buffer = node.serialize();\n    const cid = await persist(buffer, block, this.options);\n    const size = buffer.length + node.Links.reduce((acc, curr) => acc + curr.Tsize, 0);\n    this.cid = cid;\n    this.size = size;\n    yield {\n      cid,\n      unixfs,\n      path,\n      size\n    };\n  }\n\n}\n\nmodule.exports = DirFlat;","map":{"version":3,"sources":["/Users/yenerkaraca/Documents/GitHub/eth-app/node_modules/ipfs-unixfs-importer/src/dir-flat.js"],"names":["DAGLink","DAGNode","require","UnixFS","Dir","persist","DirFlat","constructor","props","options","_children","put","name","value","cid","undefined","size","get","childCount","Object","keys","length","directChildrenCount","onlyChild","eachChildSeries","i","key","child","flush","path","block","children","links","entry","push","unixfs","type","mtime","mode","node","marshal","buffer","serialize","Links","reduce","acc","curr","Tsize","module","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nconst {\n  DAGLink,\n  DAGNode\n} = require('ipld-dag-pb')\nconst UnixFS = require('ipfs-unixfs')\nconst Dir = require('./dir')\nconst persist = require('./utils/persist')\n\nclass DirFlat extends Dir {\n  constructor (props, options) {\n    super(props, options)\n    this._children = {}\n  }\n\n  put (name, value) {\n    this.cid = undefined\n    this.size = undefined\n\n    this._children[name] = value\n  }\n\n  get (name) {\n    return this._children[name]\n  }\n\n  childCount () {\n    return Object.keys(this._children).length\n  }\n\n  directChildrenCount () {\n    return this.childCount()\n  }\n\n  onlyChild () {\n    return this._children[Object.keys(this._children)[0]]\n  }\n\n  * eachChildSeries () {\n    const keys = Object.keys(this._children)\n\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i]\n\n      yield {\n        key: key,\n        child: this._children[key]\n      }\n    }\n  }\n\n  async * flush (path, block) {\n    const children = Object.keys(this._children)\n    const links = []\n\n    for (let i = 0; i < children.length; i++) {\n      let child = this._children[children[i]]\n\n      if (typeof child.flush === 'function') {\n        for await (const entry of child.flush(child.path, block)) {\n          child = entry\n\n          yield child\n        }\n      }\n\n      links.push(new DAGLink(children[i], child.size, child.cid))\n    }\n\n    const unixfs = new UnixFS({\n      type: 'directory',\n      mtime: this.mtime,\n      mode: this.mode\n    })\n\n    const node = new DAGNode(unixfs.marshal(), links)\n    const buffer = node.serialize()\n    const cid = await persist(buffer, block, this.options)\n    const size = buffer.length + node.Links.reduce((acc, curr) => acc + curr.Tsize, 0)\n\n    this.cid = cid\n    this.size = size\n\n    yield {\n      cid,\n      unixfs,\n      path,\n      size\n    }\n  }\n}\n\nmodule.exports = DirFlat\n"]},"metadata":{},"sourceType":"script"}