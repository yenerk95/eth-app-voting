{"ast":null,"code":"'use strict';\n\nconst errcode = require('err-code');\n\nconst PeerId = require('peer-id');\n\nconst {\n  codes: {\n    ERR_INVALID_PARAMETERS\n  }\n} = require('../errors');\n\nconst passthrough = data => data;\n/**\n * The Book is the skeleton for the PeerStore books.\n */\n\n\nclass Book {\n  /**\n   * @constructor\n   * @param {Object} properties\n   * @param {PeerStore} properties.peerStore PeerStore instance.\n   * @param {string} properties.eventName Name of the event to emit by the PeerStore.\n   * @param {string} properties.eventProperty Name of the property to emit by the PeerStore.\n   * @param {function} [properties.eventTransformer] Transformer function of the provided data for being emitted.\n   */\n  constructor({\n    peerStore,\n    eventName,\n    eventProperty,\n    eventTransformer = passthrough\n  }) {\n    this._ps = peerStore;\n    this.eventName = eventName;\n    this.eventProperty = eventProperty;\n    this.eventTransformer = eventTransformer;\n    /**\n     * Map known peers to their data.\n     * @type {Map<string, Array<Data>}\n     */\n\n    this.data = new Map();\n  }\n  /**\n   * Set known data of a provided peer.\n   * @param {PeerId} peerId\n   * @param {Array<Data>|Data} data\n   */\n\n\n  set(peerId, data) {\n    throw errcode(new Error('set must be implemented by the subclass'), 'ERR_NOT_IMPLEMENTED');\n  }\n  /**\n   * Set data into the datastructure, persistence and emit it using the provided transformers.\n   * @private\n   * @param {PeerId} peerId peerId of the data to store\n   * @param {*} data data to store.\n   * @param {Object} [options] storing options.\n   * @param {boolean} [options.emit = true] emit the provided data.\n   * @return {void}\n   */\n\n\n  _setData(peerId, data, {\n    emit = true\n  } = {}) {\n    const b58key = peerId.toB58String(); // Store data in memory\n\n    this.data.set(b58key, data); // Emit event\n\n    emit && this._emit(peerId, data);\n  }\n  /**\n   * Emit data.\n   * @private\n   * @param {PeerId} peerId\n   * @param {*} data\n   */\n\n\n  _emit(peerId, data) {\n    this._ps.emit(this.eventName, {\n      peerId,\n      [this.eventProperty]: this.eventTransformer(data)\n    });\n  }\n  /**\n   * Get the known data of a provided peer.\n   * @param {PeerId} peerId\n   * @returns {Array<Data>}\n   */\n\n\n  get(peerId) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS);\n    }\n\n    const rec = this.data.get(peerId.toB58String());\n    return rec ? [...rec] : undefined;\n  }\n  /**\n   * Deletes the provided peer from the book.\n   * @param {PeerId} peerId\n   * @returns {boolean}\n   */\n\n\n  delete(peerId) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS);\n    }\n\n    if (!this.data.delete(peerId.toB58String())) {\n      return false;\n    }\n\n    this._emit(peerId, []);\n\n    return true;\n  }\n\n}\n\nmodule.exports = Book;","map":{"version":3,"sources":["/Users/yenerkaraca/Documents/GitHub/eth-app/node_modules/libp2p/src/peer-store/book.js"],"names":["errcode","require","PeerId","codes","ERR_INVALID_PARAMETERS","passthrough","data","Book","constructor","peerStore","eventName","eventProperty","eventTransformer","_ps","Map","set","peerId","Error","_setData","emit","b58key","toB58String","_emit","get","isPeerId","rec","undefined","delete","module","exports"],"mappings":"AAAA;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,UAAD,CAAvB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,SAAD,CAAtB;;AAEA,MAAM;AACJE,EAAAA,KAAK,EAAE;AAAEC,IAAAA;AAAF;AADH,IAEFH,OAAO,CAAC,WAAD,CAFX;;AAIA,MAAMI,WAAW,GAAGC,IAAI,IAAIA,IAA5B;AAEA;;;;;AAGA,MAAMC,IAAN,CAAW;AACT;;;;;;;;AAQAC,EAAAA,WAAW,CAAE;AAAEC,IAAAA,SAAF;AAAaC,IAAAA,SAAb;AAAwBC,IAAAA,aAAxB;AAAuCC,IAAAA,gBAAgB,GAAGP;AAA1D,GAAF,EAA2E;AACpF,SAAKQ,GAAL,GAAWJ,SAAX;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKC,aAAL,GAAqBA,aAArB;AACA,SAAKC,gBAAL,GAAwBA,gBAAxB;AAEA;;;;;AAIA,SAAKN,IAAL,GAAY,IAAIQ,GAAJ,EAAZ;AACD;AAED;;;;;;;AAKAC,EAAAA,GAAG,CAAEC,MAAF,EAAUV,IAAV,EAAgB;AACjB,UAAMN,OAAO,CAAC,IAAIiB,KAAJ,CAAU,yCAAV,CAAD,EAAuD,qBAAvD,CAAb;AACD;AAED;;;;;;;;;;;AASAC,EAAAA,QAAQ,CAAEF,MAAF,EAAUV,IAAV,EAAgB;AAAEa,IAAAA,IAAI,GAAG;AAAT,MAAkB,EAAlC,EAAsC;AAC5C,UAAMC,MAAM,GAAGJ,MAAM,CAACK,WAAP,EAAf,CAD4C,CAG5C;;AACA,SAAKf,IAAL,CAAUS,GAAV,CAAcK,MAAd,EAAsBd,IAAtB,EAJ4C,CAM5C;;AACAa,IAAAA,IAAI,IAAI,KAAKG,KAAL,CAAWN,MAAX,EAAmBV,IAAnB,CAAR;AACD;AAED;;;;;;;;AAMAgB,EAAAA,KAAK,CAAEN,MAAF,EAAUV,IAAV,EAAgB;AACnB,SAAKO,GAAL,CAASM,IAAT,CAAc,KAAKT,SAAnB,EAA8B;AAC5BM,MAAAA,MAD4B;AAE5B,OAAC,KAAKL,aAAN,GAAsB,KAAKC,gBAAL,CAAsBN,IAAtB;AAFM,KAA9B;AAID;AAED;;;;;;;AAKAiB,EAAAA,GAAG,CAAEP,MAAF,EAAU;AACX,QAAI,CAACd,MAAM,CAACsB,QAAP,CAAgBR,MAAhB,CAAL,EAA8B;AAC5B,YAAMhB,OAAO,CAAC,IAAIiB,KAAJ,CAAU,uCAAV,CAAD,EAAqDb,sBAArD,CAAb;AACD;;AAED,UAAMqB,GAAG,GAAG,KAAKnB,IAAL,CAAUiB,GAAV,CAAcP,MAAM,CAACK,WAAP,EAAd,CAAZ;AAEA,WAAOI,GAAG,GAAG,CAAC,GAAGA,GAAJ,CAAH,GAAcC,SAAxB;AACD;AAED;;;;;;;AAKAC,EAAAA,MAAM,CAAEX,MAAF,EAAU;AACd,QAAI,CAACd,MAAM,CAACsB,QAAP,CAAgBR,MAAhB,CAAL,EAA8B;AAC5B,YAAMhB,OAAO,CAAC,IAAIiB,KAAJ,CAAU,uCAAV,CAAD,EAAqDb,sBAArD,CAAb;AACD;;AAED,QAAI,CAAC,KAAKE,IAAL,CAAUqB,MAAV,CAAiBX,MAAM,CAACK,WAAP,EAAjB,CAAL,EAA6C;AAC3C,aAAO,KAAP;AACD;;AAED,SAAKC,KAAL,CAAWN,MAAX,EAAmB,EAAnB;;AAEA,WAAO,IAAP;AACD;;AA/FQ;;AAkGXY,MAAM,CAACC,OAAP,GAAiBtB,IAAjB","sourcesContent":["'use strict'\n\nconst errcode = require('err-code')\nconst PeerId = require('peer-id')\n\nconst {\n  codes: { ERR_INVALID_PARAMETERS }\n} = require('../errors')\n\nconst passthrough = data => data\n\n/**\n * The Book is the skeleton for the PeerStore books.\n */\nclass Book {\n  /**\n   * @constructor\n   * @param {Object} properties\n   * @param {PeerStore} properties.peerStore PeerStore instance.\n   * @param {string} properties.eventName Name of the event to emit by the PeerStore.\n   * @param {string} properties.eventProperty Name of the property to emit by the PeerStore.\n   * @param {function} [properties.eventTransformer] Transformer function of the provided data for being emitted.\n   */\n  constructor ({ peerStore, eventName, eventProperty, eventTransformer = passthrough }) {\n    this._ps = peerStore\n    this.eventName = eventName\n    this.eventProperty = eventProperty\n    this.eventTransformer = eventTransformer\n\n    /**\n     * Map known peers to their data.\n     * @type {Map<string, Array<Data>}\n     */\n    this.data = new Map()\n  }\n\n  /**\n   * Set known data of a provided peer.\n   * @param {PeerId} peerId\n   * @param {Array<Data>|Data} data\n   */\n  set (peerId, data) {\n    throw errcode(new Error('set must be implemented by the subclass'), 'ERR_NOT_IMPLEMENTED')\n  }\n\n  /**\n   * Set data into the datastructure, persistence and emit it using the provided transformers.\n   * @private\n   * @param {PeerId} peerId peerId of the data to store\n   * @param {*} data data to store.\n   * @param {Object} [options] storing options.\n   * @param {boolean} [options.emit = true] emit the provided data.\n   * @return {void}\n   */\n  _setData (peerId, data, { emit = true } = {}) {\n    const b58key = peerId.toB58String()\n\n    // Store data in memory\n    this.data.set(b58key, data)\n\n    // Emit event\n    emit && this._emit(peerId, data)\n  }\n\n  /**\n   * Emit data.\n   * @private\n   * @param {PeerId} peerId\n   * @param {*} data\n   */\n  _emit (peerId, data) {\n    this._ps.emit(this.eventName, {\n      peerId,\n      [this.eventProperty]: this.eventTransformer(data)\n    })\n  }\n\n  /**\n   * Get the known data of a provided peer.\n   * @param {PeerId} peerId\n   * @returns {Array<Data>}\n   */\n  get (peerId) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS)\n    }\n\n    const rec = this.data.get(peerId.toB58String())\n\n    return rec ? [...rec] : undefined\n  }\n\n  /**\n   * Deletes the provided peer from the book.\n   * @param {PeerId} peerId\n   * @returns {boolean}\n   */\n  delete (peerId) {\n    if (!PeerId.isPeerId(peerId)) {\n      throw errcode(new Error('peerId must be an instance of peer-id'), ERR_INVALID_PARAMETERS)\n    }\n\n    if (!this.data.delete(peerId.toB58String())) {\n      return false\n    }\n\n    this._emit(peerId, [])\n\n    return true\n  }\n}\n\nmodule.exports = Book\n"]},"metadata":{},"sourceType":"script"}