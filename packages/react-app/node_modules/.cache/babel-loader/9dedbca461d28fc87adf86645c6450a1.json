{"ast":null,"code":"/*!\n * chacha20.js - chacha20 for bcrypto\n * Copyright (c) 2016-2019, Christopher Jeffrey (MIT License).\n * https://github.com/bcoin-org/bcrypto\n *\n * Resources\n *   https://en.wikipedia.org/wiki/Chacha20\n *   https://tools.ietf.org/html/rfc7539#section-2\n *   https://cr.yp.to/chacha.html\n */\n'use strict';\n\nconst assert = require('../internal/assert');\n/*\n * Constants\n */\n\n\nconst BIG_ENDIAN = new Int8Array(new Int16Array([1]).buffer)[0] === 0;\n/**\n * ChaCha20\n */\n\nclass ChaCha20 {\n  /**\n   * Create a ChaCha20 context.\n   * @constructor\n   */\n  constructor() {\n    this.state = new Uint32Array(16);\n    this.stream = new Uint32Array(16);\n    this.bytes = new Uint8Array(this.stream.buffer);\n    this.pos = -1;\n    if (BIG_ENDIAN) this.bytes = Buffer.alloc(64);\n  }\n  /**\n   * Initialize chacha20 with a key, nonce, and counter.\n   * @param {Buffer} key\n   * @param {Buffer} nonce\n   * @param {Number} counter\n   */\n\n\n  init(key, nonce, counter) {\n    if (counter == null) counter = 0;\n    assert(Buffer.isBuffer(key));\n    assert(Buffer.isBuffer(nonce));\n    assert(Number.isSafeInteger(counter));\n    if (key.length !== 16 && key.length !== 32) throw new RangeError('Invalid key size.');\n\n    if (nonce.length >= 24) {\n      key = ChaCha20.derive(key, nonce.slice(0, 16));\n      nonce = nonce.slice(16);\n    }\n\n    this.state[0] = 0x61707865;\n    this.state[1] = key.length < 32 ? 0x3120646e : 0x3320646e;\n    this.state[2] = key.length < 32 ? 0x79622d36 : 0x79622d32;\n    this.state[3] = 0x6b206574;\n    this.state[4] = readU32(key, 0);\n    this.state[5] = readU32(key, 4);\n    this.state[6] = readU32(key, 8);\n    this.state[7] = readU32(key, 12);\n    this.state[8] = readU32(key, 16 % key.length);\n    this.state[9] = readU32(key, 20 % key.length);\n    this.state[10] = readU32(key, 24 % key.length);\n    this.state[11] = readU32(key, 28 % key.length);\n    this.state[12] = counter >>> 0;\n\n    if (nonce.length === 8) {\n      this.state[13] = counter / 0x100000000 >>> 0;\n      this.state[14] = readU32(nonce, 0);\n      this.state[15] = readU32(nonce, 4);\n    } else if (nonce.length === 12) {\n      this.state[13] = readU32(nonce, 0);\n      this.state[14] = readU32(nonce, 4);\n      this.state[15] = readU32(nonce, 8);\n    } else if (nonce.length === 16) {\n      this.state[12] = readU32(nonce, 0);\n      this.state[13] = readU32(nonce, 4);\n      this.state[14] = readU32(nonce, 8);\n      this.state[15] = readU32(nonce, 12);\n    } else {\n      throw new RangeError('Invalid nonce size.');\n    }\n\n    this.pos = 0;\n    return this;\n  }\n  /**\n   * Encrypt/decrypt data.\n   * @param {Buffer} data - Will be mutated.\n   * @returns {Buffer}\n   */\n\n\n  encrypt(data) {\n    assert(Buffer.isBuffer(data));\n    if (this.pos === -1) throw new Error('Context is not initialized.');\n\n    for (let i = 0; i < data.length; i++) {\n      if ((this.pos & 63) === 0) {\n        this._block();\n\n        this.pos = 0;\n      }\n\n      data[i] ^= this.bytes[this.pos++];\n    }\n\n    return data;\n  }\n  /**\n   * Stir the stream.\n   */\n\n\n  _block() {\n    for (let i = 0; i < 16; i++) this.stream[i] = this.state[i];\n\n    for (let i = 0; i < 10; i++) {\n      qround(this.stream, 0, 4, 8, 12);\n      qround(this.stream, 1, 5, 9, 13);\n      qround(this.stream, 2, 6, 10, 14);\n      qround(this.stream, 3, 7, 11, 15);\n      qround(this.stream, 0, 5, 10, 15);\n      qround(this.stream, 1, 6, 11, 12);\n      qround(this.stream, 2, 7, 8, 13);\n      qround(this.stream, 3, 4, 9, 14);\n    }\n\n    for (let i = 0; i < 16; i++) this.stream[i] += this.state[i];\n\n    if (BIG_ENDIAN) {\n      for (let i = 0; i < 16; i++) writeU32(this.bytes, this.stream[i], i * 4);\n    }\n\n    this.state[12] += 1;\n    if (this.state[12] === 0) this.state[13] += 1;\n  }\n  /**\n   * Destroy context.\n   */\n\n\n  destroy() {\n    for (let i = 0; i < 16; i++) {\n      this.state[i] = 0;\n      this.stream[i] = 0;\n    }\n\n    if (BIG_ENDIAN) {\n      for (let i = 0; i < 64; i++) this.bytes[i] = 0;\n    }\n\n    this.pos = -1;\n    return this;\n  }\n  /**\n   * Derive key with XChaCha20.\n   * @param {Buffer} key\n   * @param {Buffer} nonce\n   * @returns {Buffer}\n   */\n\n\n  static derive(key, nonce) {\n    assert(Buffer.isBuffer(key));\n    assert(Buffer.isBuffer(nonce));\n    if (key.length !== 16 && key.length !== 32) throw new RangeError('Invalid key size.');\n    if (nonce.length !== 16) throw new RangeError('Invalid nonce size.');\n    const state = new Uint32Array(16);\n    state[0] = 0x61707865;\n    state[1] = key.length < 32 ? 0x3120646e : 0x3320646e;\n    state[2] = key.length < 32 ? 0x79622d36 : 0x79622d32;\n    state[3] = 0x6b206574;\n    state[4] = readU32(key, 0);\n    state[5] = readU32(key, 4);\n    state[6] = readU32(key, 8);\n    state[7] = readU32(key, 12);\n    state[8] = readU32(key, 16 % key.length);\n    state[9] = readU32(key, 20 % key.length);\n    state[10] = readU32(key, 24 % key.length);\n    state[11] = readU32(key, 28 % key.length);\n    state[12] = readU32(nonce, 0);\n    state[13] = readU32(nonce, 4);\n    state[14] = readU32(nonce, 8);\n    state[15] = readU32(nonce, 12);\n\n    for (let i = 0; i < 10; i++) {\n      qround(state, 0, 4, 8, 12);\n      qround(state, 1, 5, 9, 13);\n      qround(state, 2, 6, 10, 14);\n      qround(state, 3, 7, 11, 15);\n      qround(state, 0, 5, 10, 15);\n      qround(state, 1, 6, 11, 12);\n      qround(state, 2, 7, 8, 13);\n      qround(state, 3, 4, 9, 14);\n    }\n\n    const out = Buffer.alloc(32);\n    writeU32(out, state[0], 0);\n    writeU32(out, state[1], 4);\n    writeU32(out, state[2], 8);\n    writeU32(out, state[3], 12);\n    writeU32(out, state[12], 16);\n    writeU32(out, state[13], 20);\n    writeU32(out, state[14], 24);\n    writeU32(out, state[15], 28);\n    return out;\n  }\n\n}\n/*\n * Static\n */\n\n\nChaCha20.native = 0;\n/*\n * Helpers\n */\n\nfunction qround(x, a, b, c, d) {\n  x[a] += x[b];\n  x[d] = rotl32(x[d] ^ x[a], 16);\n  x[c] += x[d];\n  x[b] = rotl32(x[b] ^ x[c], 12);\n  x[a] += x[b];\n  x[d] = rotl32(x[d] ^ x[a], 8);\n  x[c] += x[d];\n  x[b] = rotl32(x[b] ^ x[c], 7);\n}\n\nfunction rotl32(w, b) {\n  return w << b | w >>> 32 - b;\n}\n\nfunction readU32(data, off) {\n  return data[off++] + data[off++] * 0x100 + data[off++] * 0x10000 + data[off] * 0x1000000;\n}\n\nfunction writeU32(dst, num, off) {\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  return off;\n}\n/*\n * Expose\n */\n\n\nmodule.exports = ChaCha20;","map":{"version":3,"sources":["/Users/yenerkaraca/Documents/GitHub/eth-app/node_modules/bcrypto/lib/js/chacha20.js"],"names":["assert","require","BIG_ENDIAN","Int8Array","Int16Array","buffer","ChaCha20","constructor","state","Uint32Array","stream","bytes","Uint8Array","pos","Buffer","alloc","init","key","nonce","counter","isBuffer","Number","isSafeInteger","length","RangeError","derive","slice","readU32","encrypt","data","Error","i","_block","qround","writeU32","destroy","out","native","x","a","b","c","d","rotl32","w","off","dst","num","module","exports"],"mappings":"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","sourcesContent":["/*!\n * chacha20.js - chacha20 for bcrypto\n * Copyright (c) 2016-2019, Christopher Jeffrey (MIT License).\n * https://github.com/bcoin-org/bcrypto\n *\n * Resources\n *   https://en.wikipedia.org/wiki/Chacha20\n *   https://tools.ietf.org/html/rfc7539#section-2\n *   https://cr.yp.to/chacha.html\n */\n\n'use strict';\n\nconst assert = require('../internal/assert');\n\n/*\n * Constants\n */\n\nconst BIG_ENDIAN = new Int8Array(new Int16Array([1]).buffer)[0] === 0;\n\n/**\n * ChaCha20\n */\n\nclass ChaCha20 {\n  /**\n   * Create a ChaCha20 context.\n   * @constructor\n   */\n\n  constructor() {\n    this.state = new Uint32Array(16);\n    this.stream = new Uint32Array(16);\n    this.bytes = new Uint8Array(this.stream.buffer);\n    this.pos = -1;\n\n    if (BIG_ENDIAN)\n      this.bytes = Buffer.alloc(64);\n  }\n\n  /**\n   * Initialize chacha20 with a key, nonce, and counter.\n   * @param {Buffer} key\n   * @param {Buffer} nonce\n   * @param {Number} counter\n   */\n\n  init(key, nonce, counter) {\n    if (counter == null)\n      counter = 0;\n\n    assert(Buffer.isBuffer(key));\n    assert(Buffer.isBuffer(nonce));\n    assert(Number.isSafeInteger(counter));\n\n    if (key.length !== 16 && key.length !== 32)\n      throw new RangeError('Invalid key size.');\n\n    if (nonce.length >= 24) {\n      key = ChaCha20.derive(key, nonce.slice(0, 16));\n      nonce = nonce.slice(16);\n    }\n\n    this.state[0] = 0x61707865;\n    this.state[1] = key.length < 32 ? 0x3120646e : 0x3320646e;\n    this.state[2] = key.length < 32 ? 0x79622d36 : 0x79622d32;\n    this.state[3] = 0x6b206574;\n    this.state[4] = readU32(key, 0);\n    this.state[5] = readU32(key, 4);\n    this.state[6] = readU32(key, 8);\n    this.state[7] = readU32(key, 12);\n    this.state[8] = readU32(key, 16 % key.length);\n    this.state[9] = readU32(key, 20 % key.length);\n    this.state[10] = readU32(key, 24 % key.length);\n    this.state[11] = readU32(key, 28 % key.length);\n    this.state[12] = counter >>> 0;\n\n    if (nonce.length === 8) {\n      this.state[13] = (counter / 0x100000000) >>> 0;\n      this.state[14] = readU32(nonce, 0);\n      this.state[15] = readU32(nonce, 4);\n    } else if (nonce.length === 12) {\n      this.state[13] = readU32(nonce, 0);\n      this.state[14] = readU32(nonce, 4);\n      this.state[15] = readU32(nonce, 8);\n    } else if (nonce.length === 16) {\n      this.state[12] = readU32(nonce, 0);\n      this.state[13] = readU32(nonce, 4);\n      this.state[14] = readU32(nonce, 8);\n      this.state[15] = readU32(nonce, 12);\n    } else {\n      throw new RangeError('Invalid nonce size.');\n    }\n\n    this.pos = 0;\n\n    return this;\n  }\n\n  /**\n   * Encrypt/decrypt data.\n   * @param {Buffer} data - Will be mutated.\n   * @returns {Buffer}\n   */\n\n  encrypt(data) {\n    assert(Buffer.isBuffer(data));\n\n    if (this.pos === -1)\n      throw new Error('Context is not initialized.');\n\n    for (let i = 0; i < data.length; i++) {\n      if ((this.pos & 63) === 0) {\n        this._block();\n        this.pos = 0;\n      }\n\n      data[i] ^= this.bytes[this.pos++];\n    }\n\n    return data;\n  }\n\n  /**\n   * Stir the stream.\n   */\n\n  _block() {\n    for (let i = 0; i < 16; i++)\n      this.stream[i] = this.state[i];\n\n    for (let i = 0; i < 10; i++) {\n      qround(this.stream, 0, 4, 8, 12);\n      qround(this.stream, 1, 5, 9, 13);\n      qround(this.stream, 2, 6, 10, 14);\n      qround(this.stream, 3, 7, 11, 15);\n      qround(this.stream, 0, 5, 10, 15);\n      qround(this.stream, 1, 6, 11, 12);\n      qround(this.stream, 2, 7, 8, 13);\n      qround(this.stream, 3, 4, 9, 14);\n    }\n\n    for (let i = 0; i < 16; i++)\n      this.stream[i] += this.state[i];\n\n    if (BIG_ENDIAN) {\n      for (let i = 0; i < 16; i++)\n        writeU32(this.bytes, this.stream[i], i * 4);\n    }\n\n    this.state[12] += 1;\n\n    if (this.state[12] === 0)\n      this.state[13] += 1;\n  }\n\n  /**\n   * Destroy context.\n   */\n\n  destroy() {\n    for (let i = 0; i < 16; i++) {\n      this.state[i] = 0;\n      this.stream[i] = 0;\n    }\n\n    if (BIG_ENDIAN) {\n      for (let i = 0; i < 64; i++)\n        this.bytes[i] = 0;\n    }\n\n    this.pos = -1;\n\n    return this;\n  }\n\n  /**\n   * Derive key with XChaCha20.\n   * @param {Buffer} key\n   * @param {Buffer} nonce\n   * @returns {Buffer}\n   */\n\n  static derive(key, nonce) {\n    assert(Buffer.isBuffer(key));\n    assert(Buffer.isBuffer(nonce));\n\n    if (key.length !== 16 && key.length !== 32)\n      throw new RangeError('Invalid key size.');\n\n    if (nonce.length !== 16)\n      throw new RangeError('Invalid nonce size.');\n\n    const state = new Uint32Array(16);\n\n    state[0] = 0x61707865;\n    state[1] = key.length < 32 ? 0x3120646e : 0x3320646e;\n    state[2] = key.length < 32 ? 0x79622d36 : 0x79622d32;\n    state[3] = 0x6b206574;\n    state[4] = readU32(key, 0);\n    state[5] = readU32(key, 4);\n    state[6] = readU32(key, 8);\n    state[7] = readU32(key, 12);\n    state[8] = readU32(key, 16 % key.length);\n    state[9] = readU32(key, 20 % key.length);\n    state[10] = readU32(key, 24 % key.length);\n    state[11] = readU32(key, 28 % key.length);\n    state[12] = readU32(nonce, 0);\n    state[13] = readU32(nonce, 4);\n    state[14] = readU32(nonce, 8);\n    state[15] = readU32(nonce, 12);\n\n    for (let i = 0; i < 10; i++) {\n      qround(state, 0, 4, 8, 12);\n      qround(state, 1, 5, 9, 13);\n      qround(state, 2, 6, 10, 14);\n      qround(state, 3, 7, 11, 15);\n      qround(state, 0, 5, 10, 15);\n      qround(state, 1, 6, 11, 12);\n      qround(state, 2, 7, 8, 13);\n      qround(state, 3, 4, 9, 14);\n    }\n\n    const out = Buffer.alloc(32);\n\n    writeU32(out, state[0], 0);\n    writeU32(out, state[1], 4);\n    writeU32(out, state[2], 8);\n    writeU32(out, state[3], 12);\n    writeU32(out, state[12], 16);\n    writeU32(out, state[13], 20);\n    writeU32(out, state[14], 24);\n    writeU32(out, state[15], 28);\n\n    return out;\n  }\n}\n\n/*\n * Static\n */\n\nChaCha20.native = 0;\n\n/*\n * Helpers\n */\n\nfunction qround(x, a, b, c, d) {\n  x[a] += x[b];\n  x[d] = rotl32(x[d] ^ x[a], 16);\n\n  x[c] += x[d];\n  x[b] = rotl32(x[b] ^ x[c], 12);\n\n  x[a] += x[b];\n  x[d] = rotl32(x[d] ^ x[a], 8);\n\n  x[c] += x[d];\n  x[b] = rotl32(x[b] ^ x[c], 7);\n}\n\nfunction rotl32(w, b) {\n  return (w << b) | (w >>> (32 - b));\n}\n\nfunction readU32(data, off) {\n  return (data[off++]\n        + data[off++] * 0x100\n        + data[off++] * 0x10000\n        + data[off] * 0x1000000);\n}\n\nfunction writeU32(dst, num, off) {\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  num >>>= 8;\n  dst[off++] = num;\n  return off;\n}\n\n/*\n * Expose\n */\n\nmodule.exports = ChaCha20;\n"]},"metadata":{},"sourceType":"script"}