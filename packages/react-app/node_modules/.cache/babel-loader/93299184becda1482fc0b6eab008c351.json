{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yenerkaraca/Documents/GitHub/eth-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _slicedToArray from\"/Users/yenerkaraca/Documents/GitHub/eth-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"/Users/yenerkaraca/Documents/GitHub/eth-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _asyncIterator from\"/Users/yenerkaraca/Documents/GitHub/eth-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncIterator\";import React,{useCallback,useEffect,useState}from\"react\";import{useDropzone}from\"react-dropzone\";import{ethers}from\"ethers\";import IPFS from\"ipfs\";import logo from\"./ethereumLogo.png\";import{addresses,abis}from\"@project/contracts\";import\"./App.css\";var ZERO_ADDRESS=\"0x0000000000000000000000000000000000000000000000000000000000000000\";var node;var defaultProvider=new ethers.providers.Web3Provider(window.ethereum);var ipfsContract=new ethers.Contract(addresses.ipfs,abis.ipfs,defaultProvider);var storageContract=new ethers.Contract(addresses.storage,abis.storage,defaultProvider);function initIpfs(){return _initIpfs.apply(this,arguments);}function _initIpfs(){_initIpfs=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){var version;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return IPFS.create();case 2:node=_context9.sent;_context9.next=5;return node.version();case 5:version=_context9.sent;console.log(\"IPFS Node Version:\",version.version);case 7:case\"end\":return _context9.stop();}}},_callee9);}));return _initIpfs.apply(this,arguments);}function readCurrentUserFile(){return _readCurrentUserFile.apply(this,arguments);}function _readCurrentUserFile(){_readCurrentUserFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){var result,accounts,account;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return ipfsContract.userFiles(defaultProvider.getSigner().getAddress());case 2:result=_context10.sent;console.log({result:result});_context10.next=6;return window.ethereum.request({method:'eth_requestAccounts'});case 6:accounts=_context10.sent;account=accounts[0];//metamask current account\nreturn _context10.abrupt(\"return\",result);case 9:case\"end\":return _context10.stop();}}},_callee10);}));return _readCurrentUserFile.apply(this,arguments);}function getaccount(){return _getaccount.apply(this,arguments);}function _getaccount(){_getaccount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(){var accounts,account;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.next=2;return window.ethereum.request({method:'eth_requestAccounts'});case 2:accounts=_context11.sent;Object.values(accounts);account=JSON.stringify(accounts[0]);console.log(\"FUNC\");console.log({account:account});return _context11.abrupt(\"return\",account);case 8:case\"end\":return _context11.stop();}}},_callee11);}));return _getaccount.apply(this,arguments);}function App(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),ipfsHash=_useState2[0],setIpfsHash=_useState2[1];useEffect(function(){initIpfs();window.ethereum.enable();},[]);useEffect(function(){function readFile(){return _readFile.apply(this,arguments);}function _readFile(){_readFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var file;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return readCurrentUserFile();case 2:file=_context.sent;if(file!==ZERO_ADDRESS)setIpfsHash(file);case 4:case\"end\":return _context.stop();}}},_callee);}));return _readFile.apply(this,arguments);}readFile();},[]);var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),accountHash=_useState4[0],setAccountHash=_useState4[1];useEffect(function(){window.ethereum.enable();},[]);useEffect(function(){function readFile(){return _readFile2.apply(this,arguments);}function _readFile2(){_readFile2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var file1;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getaccount();case 2:file1=_context2.sent;if(file1!==ZERO_ADDRESS)setAccountHash(file1);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return _readFile2.apply(this,arguments);}readFile();},[]);function setFile(_x){return _setFile.apply(this,arguments);}function _setFile(){_setFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(hash){var ipfsWithSigner,tx;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:ipfsWithSigner=ipfsContract.connect(defaultProvider.getSigner());_context4.next=3;return ipfsWithSigner.setFile(hash);case 3:tx=_context4.sent;console.log({tx:tx});setIpfsHash(hash);ipfsWithSigner.store(hash);case 7:case\"end\":return _context4.stop();}}},_callee4);}));return _setFile.apply(this,arguments);}function Buyer(){return _Buyer.apply(this,arguments);}function _Buyer(){_Buyer=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var storageWithSigner;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:storageWithSigner=storageContract.connect(defaultProvider.getSigner());_context5.next=3;return storageWithSigner.buyerUpload(ipfsHash);case 3:case\"end\":return _context5.stop();}}},_callee5);}));return _Buyer.apply(this,arguments);}function Seller(){return _Seller.apply(this,arguments);}function _Seller(){_Seller=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var storageWithSigner;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:storageWithSigner=storageContract.connect(defaultProvider.getSigner());_context6.next=3;return storageWithSigner.sellerUpload(ipfsHash);case 3:case\"end\":return _context6.stop();}}},_callee6);}));return _Seller.apply(this,arguments);}function Set(){return _Set.apply(this,arguments);}function _Set(){_Set=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var storageWithSigner;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:storageWithSigner=storageContract.connect(defaultProvider.getSigner());_context7.next=3;return storageWithSigner.SetEndTime(itemInput);case 3:case\"end\":return _context7.stop();}}},_callee7);}));return _Set.apply(this,arguments);}function Extend(){return _Extend.apply(this,arguments);}function _Extend(){_Extend=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var storageWithSigner;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:storageWithSigner=storageContract.connect(defaultProvider.getSigner());_context8.next=3;return storageWithSigner.ExtendTime(itemInput1);case 3:case\"end\":return _context8.stop();}}},_callee8);}));return _Extend.apply(this,arguments);}console.log(ipfsHash);var uploadFile=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(file){var files,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_value,result;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:files=[{path:file.name+file.path,content:file}];_iteratorNormalCompletion=true;_didIteratorError=false;_context3.prev=3;_iterator=_asyncIterator(node.add(files));case 5:_context3.next=7;return _iterator.next();case 7:_step=_context3.sent;_iteratorNormalCompletion=_step.done;_context3.next=11;return _step.value;case 11:_value=_context3.sent;if(_iteratorNormalCompletion){_context3.next=19;break;}result=_value;_context3.next=16;return setFile(result.cid.string);case 16:_iteratorNormalCompletion=true;_context3.next=5;break;case 19:_context3.next=25;break;case 21:_context3.prev=21;_context3.t0=_context3[\"catch\"](3);_didIteratorError=true;_iteratorError=_context3.t0;case 25:_context3.prev=25;_context3.prev=26;if(!(!_iteratorNormalCompletion&&_iterator.return!=null)){_context3.next=30;break;}_context3.next=30;return _iterator.return();case 30:_context3.prev=30;if(!_didIteratorError){_context3.next=33;break;}throw _iteratorError;case 33:return _context3.finish(30);case 34:return _context3.finish(25);case 35:case\"end\":return _context3.stop();}}},_callee3,null,[[3,21,25,35],[26,,30,34]]);}));return function(_x2){return _ref.apply(this,arguments);};}(),[]);var onDrop=useCallback(function(acceptedFiles){uploadFile(acceptedFiles[0]);},[uploadFile]);var _useDropzone=useDropzone({multiple:false,onDrop:onDrop}),getRootProps=_useDropzone.getRootProps,getInputProps=_useDropzone.getInputProps,isDragActive=_useDropzone.isDragActive;var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),itemInput=_useState6[0],setItemInput=_useState6[1];console.log(itemInput);var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),itemInput1=_useState8[0],setItemInput1=_useState8[1];console.log(itemInput1);return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(\"header\",{className:\"App-header\"},/*#__PURE__*/React.createElement(\"div\",Object.assign({},getRootProps(),{style:{cursor:\"pointer\"}}),/*#__PURE__*/React.createElement(\"img\",{src:logo,className:\"App-logo\",alt:\"react-logo\"}),/*#__PURE__*/React.createElement(\"input\",getInputProps()),isDragActive?/*#__PURE__*/React.createElement(\"p\",null,\"Drop the files here ...\"):/*#__PURE__*/React.createElement(\"p\",null,\"Drag 'n' drop some files here to upload to IPFS (or click the logo)\")),/*#__PURE__*/React.createElement(\"div\",null,ipfsHash!==\"\"?/*#__PURE__*/React.createElement(\"p\",null,\"IPFS Hash: \",/*#__PURE__*/React.createElement(\"mark\",{className:\"mark-red\"},\"\\\"\",ipfsHash,\"\\\"\")):\"\"),/*#__PURE__*/React.createElement(\"div\",null,\"User Hash:\",/*#__PURE__*/React.createElement(\"mark\",{className:\"mark-yellow\"},accountHash)),/*#__PURE__*/React.createElement(\"div\",null,ipfsHash!==\"\"?/*#__PURE__*/React.createElement(\"a\",{href:\"https://ipfs.io/ipfs/\".concat(ipfsHash),target:\"_blank\",rel:\"noopener noreferrer\"},\"See current user file\"):\"No user file set yet\"),/*#__PURE__*/React.createElement(\"div\",null,\"Buyer Can Set and Extend Time\"),/*#__PURE__*/React.createElement(\"div\",null,\"Set End Time:\",/*#__PURE__*/React.createElement(\"input\",{type:\"text\",placeholder:\"Enter an item\",value:itemInput,onChange:function onChange(e){return setItemInput(e.target.value);}}),/*#__PURE__*/React.createElement(\"button\",{onClick:Set},\"Buyer Set\")),/*#__PURE__*/React.createElement(\"div\",null,\"Extend Time:\",/*#__PURE__*/React.createElement(\"input\",{type:\"text\",placeholder:\"Enter an item\",value:itemInput1,onChange:function onChange(e){return setItemInput1(e.target.value);}}),/*#__PURE__*/React.createElement(\"button\",{onClick:Extend},\"Buyer Extend\")),/*#__PURE__*/React.createElement(\"div\",null,\"Buyer Clicks to Upload to Smart Contract:   \",/*#__PURE__*/React.createElement(\"button\",{onClick:Buyer},\"Buyer Upload\")),/*#__PURE__*/React.createElement(\"div\",null,\"Seller Clicks to Upload to Smart Contract:   \",/*#__PURE__*/React.createElement(\"button\",{onClick:Seller},\"Seller Upload\")),/*#__PURE__*/React.createElement(\"script\",null)));}export default App;","map":{"version":3,"sources":["/Users/yenerkaraca/Documents/GitHub/eth-app/packages/react-app/src/App.js"],"names":["React","useCallback","useEffect","useState","useDropzone","ethers","IPFS","logo","addresses","abis","ZERO_ADDRESS","node","defaultProvider","providers","Web3Provider","window","ethereum","ipfsContract","Contract","ipfs","storageContract","storage","initIpfs","create","version","console","log","readCurrentUserFile","userFiles","getSigner","getAddress","result","request","method","accounts","account","getaccount","Object","values","JSON","stringify","App","ipfsHash","setIpfsHash","enable","readFile","file","accountHash","setAccountHash","file1","setFile","hash","ipfsWithSigner","connect","tx","store","Buyer","storageWithSigner","buyerUpload","Seller","sellerUpload","Set","SetEndTime","itemInput","Extend","ExtendTime","itemInput1","uploadFile","files","path","name","content","add","cid","string","onDrop","acceptedFiles","multiple","getRootProps","getInputProps","isDragActive","setItemInput","setItemInput1","cursor","e","target","value"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from \"react\";\nimport { useDropzone } from \"react-dropzone\";\nimport { ethers } from \"ethers\";\nimport IPFS from \"ipfs\";\n\nimport logo from \"./ethereumLogo.png\";\nimport { addresses, abis } from \"@project/contracts\";\n\nimport \"./App.css\";\nconst ZERO_ADDRESS =\n  \"0x0000000000000000000000000000000000000000000000000000000000000000\";\n\nlet node;\n\nconst defaultProvider = new ethers.providers.Web3Provider(window.ethereum);\nconst ipfsContract = new ethers.Contract(\n  addresses.ipfs,\n  abis.ipfs,\n  defaultProvider\n);\nconst storageContract = new ethers.Contract(\n  addresses.storage,\n  abis.storage,\n  defaultProvider\n);\n\n\nasync function initIpfs() {\n  node = await IPFS.create();\n  const version = await node.version();\n  console.log(\"IPFS Node Version:\", version.version);\n}\n\nasync function readCurrentUserFile() {\n  const result = await ipfsContract.userFiles(\n    defaultProvider.getSigner().getAddress()\n    \n  \n  );\n  console.log({ result });\n \n  const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });\n  const account = accounts[0];//metamask current account\n\n  \n  return result;\n}\nasync function getaccount(){\n  const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });\n  Object.values(accounts);\n  const account =JSON.stringify(accounts[0]);\n  console.log(\"FUNC\");\n\n  console.log({ account });\n\nreturn account\n}\n\nfunction App() {\n  const [ipfsHash, setIpfsHash] = useState(\"\");\n  useEffect(() => {\n    initIpfs();\n    window.ethereum.enable();\n  }, []);\n\n  useEffect(() => {\n    async function readFile() {\n      const file = await readCurrentUserFile();\n\n      if (file !== ZERO_ADDRESS) setIpfsHash(file);\n    }\n    readFile();\n  }, []);\n\n\n\n\n  const [accountHash, setAccountHash] = useState(\"\");\n  useEffect(() => {\n    window.ethereum.enable();\n  }, []);\n\n  useEffect(() => {\n    async function readFile() {\n      const file1 = await getaccount();\n\n      if (file1 !== ZERO_ADDRESS) setAccountHash(file1);\n    }\n    readFile();\n  }, []);\n\n\n\n\n  async function setFile(hash) {\n    const ipfsWithSigner = ipfsContract.connect(defaultProvider.getSigner());\n    const tx = await ipfsWithSigner.setFile(hash);\n    console.log({ tx });\n\n    setIpfsHash(hash);\n    \n    ipfsWithSigner.store(hash);\n\n  \n  }\n\n\n  async function Buyer() {\n\n    \n    const storageWithSigner = storageContract.connect(defaultProvider.getSigner());\n  \n    await storageWithSigner.buyerUpload(ipfsHash);\n  \n  }\n\n\n  async function Seller() {\n\n    \n    const storageWithSigner = storageContract.connect(defaultProvider.getSigner());\n    \n    await storageWithSigner.sellerUpload(ipfsHash);\n\n  \n  }\n  async function Set() {\n\n    \n    const storageWithSigner = storageContract.connect(defaultProvider.getSigner());\n    await storageWithSigner.SetEndTime(itemInput);\n\n  \n  }\n  async function Extend() {\n\n    \n    const storageWithSigner = storageContract.connect(defaultProvider.getSigner());\n    \n    await storageWithSigner.ExtendTime(itemInput1);\n\n  \n  }\n  \n  console.log(ipfsHash);\n  \n\n  const uploadFile = useCallback(async (file) => {\n    const files = [\n      {\n        path: file.name + file.path,\n        content: file,\n      },\n    ];\n\n    for await (const result of node.add(files)) {\n      await setFile(result.cid.string);\n    }\n  }, []);\n\n  const onDrop = useCallback(\n    (acceptedFiles) => {\n      uploadFile(acceptedFiles[0]);\n    },\n    [uploadFile]\n  );\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    multiple: false,\n    onDrop,\n  });\n\n  const [itemInput, setItemInput] = useState(\"\");\n  console.log(itemInput);\n  const [itemInput1, setItemInput1] = useState(\"\");\n  console.log(itemInput1);\n\n\n\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <div {...getRootProps()} style={{ cursor: \"pointer\" }}>\n          <img src={logo} className=\"App-logo\" alt=\"react-logo\" />\n          <input {...getInputProps()} />\n          {isDragActive ? (\n            <p>Drop the files here ...</p>\n          ) : (\n            <p>\n              Drag 'n' drop some files here to upload to IPFS (or click the\n              logo)\n            </p>\n          )}\n        </div>\n        \n        <div>\n          {ipfsHash !== \"\" ? (   \n            <p>IPFS Hash: <mark className=\"mark-red\">\"{ipfsHash}\"</mark></p>\n            ) : (\n              \"\"\n            )}\n        \n        </div>  \n        <div>User Hash:<mark className=\"mark-yellow\">{accountHash}</mark></div>\n   \n        <div>\n          {ipfsHash !== \"\" ? (\n            \n\n            <a\n            \n              href={`https://ipfs.io/ipfs/${ipfsHash}`}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              See current user file \n            </a>\n          ) : (\n            \"No user file set yet\"\n          )}\n\n        </div>\n        <div>Buyer Can Set and Extend Time</div>\n      \n        <div>\n          Set End Time:\n\n         \n          <input type=\"text\" placeholder=\"Enter an item\" value={itemInput} onChange={e => setItemInput(e.target.value)}\n        \n          />\n          <button onClick={Set}>Buyer Set</button>\n         </div>\n         <div>\n          Extend Time:\n          <input type=\"text\" placeholder=\"Enter an item\" value={itemInput1} onChange={e => setItemInput1(e.target.value)}\n         \n          />\n          <button onClick={Extend}>Buyer Extend</button>\n         </div>\n         <div>Buyer Clicks to Upload to Smart Contract:   <button onClick={Buyer}>Buyer Upload</button></div>\n         <div>Seller Clicks to Upload to Smart Contract:   <button onClick={Seller}>Seller Upload</button></div>\n         <script></script>\n      </header>\n\n    </div>\n  );\n  \n}\n\nexport default App;\n\n\n"]},"metadata":{},"sourceType":"module"}